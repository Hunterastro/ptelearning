# 🎯 英语学习系统 - 完整操作指南

## 🚀 启动系统

### 方法一：一键启动（推荐）
```bash
# 双击运行
complete-fix.bat
```

### 方法二：分步启动
```bash
# 1. 启动后端（第一个终端）
start-backend.bat

# 2. 启动前端（第二个终端）  
test-frontend.bat
```

### 方法三：手动启动
```bash
# 终端1：后端
$env:PATH = "C:\Program Files\nodejs;" + $env:PATH
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser -Force
npm run dev

# 终端2：前端
cd frontend
npm start
```

## 🔗 访问地址

- **前端应用**: http://localhost:3000
- **后端API**: http://localhost:5000/api
- **MongoDB**: 默认端口 27017

## 👤 用户管理

### 注册新用户
1. 访问 http://localhost:3000
2. 点击"立即注册"
3. 填写：用户名、邮箱、密码、确认密码
4. 提交注册

### 设置管理员权限

#### 方法一：使用MongoDB Compass（推荐）
1. 下载安装 [MongoDB Compass](https://www.mongodb.com/try/download/compass)
2. 连接到数据库：`mongodb://localhost:27017`
3. 选择数据库：`english-learning`
4. 打开集合：`users`
5. 找到您的用户记录
6. 编辑文档，将 `role` 字段改为 `"admin"`

#### 方法二：使用MongoDB Shell
```bash
# 打开MongoDB Shell
mongo

# 选择数据库
use english-learning

# 查看所有用户
db.users.find().pretty()

# 设置管理员（替换email为您的邮箱）
db.users.updateOne(
  {email: "your-email@example.com"},
  {$set: {role: "admin"}}
)

# 验证设置
db.users.findOne({email: "your-email@example.com"})
```

#### 方法三：使用API（需要先有一个管理员）
```bash
# POST /api/user/make-admin
curl -X POST http://localhost:5000/api/user/make-admin \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"userId": "USER_ID"}'
```

## 📊 MongoDB 数据库操作

### 连接数据库
```bash
# 方法1：MongoDB Shell
mongo mongodb://localhost:27017/english-learning

# 方法2：MongoDB Compass GUI
# 连接字符串：mongodb://localhost:27017
```

### 查看数据
```javascript
// 查看所有用户
db.users.find().pretty()

// 查看词汇表
db.wordlists.find().pretty()

// 查看单词
db.words.find().pretty()

// 查看学习进度
db.learningprogresses.find().pretty()

// 按条件查询用户
db.users.find({role: "admin"}).pretty()
db.users.find({email: "test@example.com"}).pretty()

// 查看学习统计
db.learningprogresses.aggregate([
  {$group: {
    _id: "$userId",
    totalWords: {$sum: {$size: "$words"}},
    completionRate: {$avg: "$completionRate"}
  }}
])
```

### 数据库维护
```javascript
// 清空测试数据
db.users.deleteMany({email: /test/})
db.wordlists.deleteMany({})
db.words.deleteMany({})
db.learningprogresses.deleteMany({})

// 重置用户密码（需要重新加密）
db.users.updateOne(
  {email: "user@example.com"},
  {$set: {password: "new_hashed_password"}}
)

// 删除特定词汇表
db.wordlists.deleteOne({_id: ObjectId("词汇表ID")})

// 查看数据库统计
db.stats()
```

## 📚 词汇表管理

### 上传Excel文件
1. 以管理员身份登录
2. 进入管理面板
3. 点击"上传词汇表"
4. 选择Excel文件（支持.xlsx, .xls, .csv）
5. 确认数据格式：
   - 第1列：英文短语
   - 第2列：中文释义  
   - 第3列：例句
   - 第4列：例句翻译

### Excel文件格式示例
```
英文短语        | 中文释义     | 例句                                    | 例句翻译
make a decision | 做决定       | I need to make a decision about my job. | 我需要对我的工作做个决定。
take advantage  | 利用，占便宜  | Take advantage of this opportunity.    | 利用这个机会。
```

## 🔧 系统调试

### 查看日志
```bash
# 后端日志在终端中直接显示
# 前端错误在浏览器控制台查看（F12）
```

### 常见问题解决

#### 前端无法连接后端
```bash
# 检查后端是否运行
curl http://localhost:5000/api/health

# 检查端口占用
netstat -ano | findstr :5000
netstat -ano | findstr :3000
```

#### MongoDB连接失败
```bash
# 检查MongoDB服务
sc query MongoDB

# 启动MongoDB
net start MongoDB

# 检查端口
netstat -ano | findstr :27017
```

#### npm命令无法识别
```bash
# 设置Node.js路径
$env:PATH = "C:\Program Files\nodejs;" + $env:PATH
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser -Force
```

### 重置系统
```bash
# 完全重置并重新安装
complete-fix.bat
```

## 📈 学习数据分析

### 查看学习进度
```javascript
// 用户学习统计
db.learningprogresses.find({userId: ObjectId("用户ID")}).pretty()

// 词汇表学习统计  
db.learningprogresses.aggregate([
  {$match: {wordlistId: ObjectId("词汇表ID")}},
  {$group: {
    _id: "$wordlistId",
    totalUsers: {$sum: 1},
    avgCompletion: {$avg: "$completionRate"},
    avgScore: {$avg: "$averageScore"}
  }}
])

// 单词掌握情况
db.learningprogresses.aggregate([
  {$unwind: "$words"},
  {$group: {
    _id: "$words.status",
    count: {$sum: 1}
  }}
])
```

## 🔒 安全设置

### 生产环境配置
```env
# .env文件配置
NODE_ENV=production
JWT_SECRET=复杂的随机字符串
JWT_REFRESH_SECRET=另一个复杂的随机字符串
MONGODB_URI=mongodb://username:password@localhost:27017/english-learning
```

### 备份数据库
```bash
# 导出数据
mongodump --db english-learning --out backup/

# 导入数据
mongorestore backup/english-learning/
```

## 📞 技术支持

### 系统要求
- **Node.js**: v16.0.0+
- **MongoDB**: v4.4.0+
- **浏览器**: Chrome, Firefox, Safari, Edge

### 性能优化
- 定期清理学习历史记录
- 优化词汇表大小（建议<2000词）
- 使用MongoDB索引优化查询

---

**🎊 享受您的英语学习之旅！** 